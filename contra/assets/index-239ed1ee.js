(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var mt=function(e,t){return mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},mt(e,t)};function M(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");mt(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Pe(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(c){try{f(r.next(c))}catch(h){s(h)}}function u(c){try{f(r.throw(c))}catch(h){s(h)}}function f(c){c.done?o(c.value):i(c.value).then(a,u)}f((r=r.apply(e,t||[])).next())})}function re(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(c){return u([f,c])}}function u(f){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(n=0)),n;)try{if(r=1,i&&(o=f[0]&2?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return n.label++,{value:f[1],done:!1};case 5:n.label++,i=f[1],f=[0];continue;case 7:f=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){n=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){n.label=f[1];break}if(f[0]===6&&n.label<o[1]){n.label=o[1],o=f;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(f);break}o[2]&&n.ops.pop(),n.trys.pop();continue}f=t.call(e,n)}catch(c){f=[6,c],i=0}finally{r=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function R(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function T(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}function k(e){return this instanceof k?(this.v=e,this):new k(e)}function Ge(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(l){r[l]&&(i[l]=function(d){return new Promise(function(v,m){o.push([l,d,v,m])>1||a(l,d)})})}function a(l,d){try{u(r[l](d))}catch(v){h(o[0][3],v)}}function u(l){l.value instanceof k?Promise.resolve(l.value.v).then(f,c):h(o[0][2],l)}function f(l){a("next",l)}function c(l){a("throw",l)}function h(l,d){l(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function ke(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof R=="function"?R(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(s){return new Promise(function(a,u){s=e[o](s),i(a,u,s.done,s.value)})}}function i(o,s,a,u){Promise.resolve(u).then(function(f){o({value:f,done:a})},s)}}function b(e){return typeof e=="function"}function ie(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var lt=ie(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function q(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var W=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=R(s),u=a.next();!u.done;u=a.next()){var f=u.value;f.remove(this)}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(b(c))try{c()}catch(m){o=m instanceof lt?m.errors:[m]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var l=R(h),d=l.next();!d.done;d=l.next()){var v=d.value;try{jt(v)}catch(m){o=o??[],m instanceof lt?o=T(T([],C(o)),C(m.errors)):o.push(m)}}}catch(m){r={error:m}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}if(o)throw new lt(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)jt(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&q(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&q(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),oe=W.EMPTY;function se(e){return e instanceof W||e&&"closed"in e&&b(e.remove)&&b(e.add)&&b(e.unsubscribe)}function jt(e){b(e)?e():e.unsubscribe()}var ae={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},yt={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=yt.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,T([e,t],C(n))):setTimeout.apply(void 0,T([e,t],C(n)))},clearTimeout:function(e){var t=yt.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ue(e){yt.setTimeout(function(){throw e})}function st(){}function it(e){e()}var It=function(e){M(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,se(n)&&n.add(r)):r.destination=$e,r}return t.create=function(n,r,i){return new vt(n,r,i)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(W),_e=Function.prototype.bind;function ht(e,t){return _e.call(e,t)}var We=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){z(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){z(r)}else z(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){z(n)}},e}(),vt=function(e){M(t,e);function t(n,r,i){var o=e.call(this)||this,s;if(b(n)||!n)s={next:n??void 0,error:r??void 0,complete:i??void 0};else{var a;o&&ae.useDeprecatedNextContext?(a=Object.create(n),a.unsubscribe=function(){return o.unsubscribe()},s={next:n.next&&ht(n.next,a),error:n.error&&ht(n.error,a),complete:n.complete&&ht(n.complete,a)}):s=n}return o.destination=new We(s),o}return t}(It);function z(e){ue(e)}function De(e){throw e}var $e={closed:!0,next:st,error:De,complete:st},Bt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function J(e){return e}function Ke(e){return e.length===0?J:e.length===1?e[0]:function(n){return e.reduce(function(r,i){return i(r)},n)}}var E=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var i=this,o=Ue(t)?t:new vt(t,n,r);return it(function(){var s=i,a=s.operator,u=s.source;o.add(a?a.call(o,u):u?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=Lt(n),new n(function(i,o){var s=new vt({next:function(a){try{t(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[Bt]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ke(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=Lt(t),new t(function(r,i){var o;n.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},e.create=function(t){return new e(t)},e}();function Lt(e){var t;return(t=e??ae.Promise)!==null&&t!==void 0?t:Promise}function Ve(e){return e&&b(e.next)&&b(e.error)&&b(e.complete)}function Ue(e){return e&&e instanceof It||Ve(e)&&se(e)}function qe(e){return b(e==null?void 0:e.lift)}function B(e){return function(t){if(qe(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function I(e,t,n,r,i){return new Je(e,t,n,r,i)}var Je=function(e){M(t,e);function t(n,r,i,o,s,a){var u=e.call(this,n)||this;return u.onFinalize=s,u.shouldUnsubscribe=a,u._next=r?function(f){try{r(f)}catch(c){n.error(c)}}:e.prototype._next,u._error=o?function(f){try{o(f)}catch(c){n.error(c)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=i?function(){try{i()}catch(f){n.error(f)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(It),V={schedule:function(e){var t=requestAnimationFrame,n=cancelAnimationFrame,r=V.delegate;r&&(t=r.requestAnimationFrame,n=r.cancelAnimationFrame);var i=t(function(o){n=void 0,e(o)});return new W(function(){return n==null?void 0:n(i)})},requestAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=V.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,T([],C(e)))},cancelAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=V.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,T([],C(e)))},delegate:void 0},Ze=ie(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),_=function(e){M(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new Pt(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ze},t.prototype.next=function(n){var r=this;it(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=R(r.currentObservers),a=s.next();!a.done;a=s.next()){var u=a.value;u.next(n)}}catch(f){i={error:f}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},t.prototype.error=function(n){var r=this;it(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},t.prototype.complete=function(){var n=this;it(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?oe:(this.currentObservers=null,a.push(n),new W(function(){r.currentObservers=null,q(a,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?n.error(o):s&&n.complete()},t.prototype.asObservable=function(){var n=new E;return n.source=this,n},t.create=function(n,r){return new Pt(n,r)},t}(E),Pt=function(e){M(t,e);function t(n,r){var i=e.call(this)||this;return i.destination=n,i.source=r,i}return t.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},t.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:oe},t}(_),fe={now:function(){return(fe.delegate||Date).now()},delegate:void 0},Ne=function(e){M(t,e);function t(n,r){return e.call(this)||this}return t.prototype.schedule=function(n,r){return this},t}(W),at={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=at.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,T([e,t],C(n))):setInterval.apply(void 0,T([e,t],C(n)))},clearInterval:function(e){var t=at.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},ce=function(e){M(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return t.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),at.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&at.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,q(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Ne),Gt=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=fe.now,e}(),le=function(e){M(t,e);function t(n,r){r===void 0&&(r=Gt.now);var i=e.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},t}(Gt),ut=new le(ce),Qe=ut,ze=function(e){M(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i}return t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),i!==null&&i>0?e.prototype.requestAsyncId.call(this,n,r,i):(n.actions.push(this),n._scheduled||(n._scheduled=V.requestAnimationFrame(function(){return n.flush(void 0)})))},t.prototype.recycleAsyncId=function(n,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,n,r,i);var s=n.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(V.cancelAnimationFrame(r),n._scheduled=void 0)},t}(ce),tn=function(e){M(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;n=n||i.shift();do if(o=n.execute(n.state,n.delay))break;while((n=i[0])&&n.id===r&&i.shift());if(this._active=!1,o){for(;(n=i[0])&&n.id===r&&i.shift();)n.unsubscribe();throw o}},t}(le),en=new tn(ze),he=new E(function(e){return e.complete()});function de(e){return e&&b(e.schedule)}function St(e){return e[e.length-1]}function nn(e){return b(St(e))?e.pop():void 0}function Z(e){return de(St(e))?e.pop():void 0}function pe(e,t){return typeof St(e)=="number"?e.pop():t}var Ct=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ge(e){return b(e==null?void 0:e.then)}function me(e){return b(e[Bt])}function ye(e){return Symbol.asyncIterator&&b(e==null?void 0:e[Symbol.asyncIterator])}function ve(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function rn(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var be=rn();function Ae(e){return b(e==null?void 0:e[be])}function we(e){return Ge(this,arguments,function(){var n,r,i,o;return re(this,function(s){switch(s.label){case 0:n=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,k(n.read())];case 3:return r=s.sent(),i=r.value,o=r.done,o?[4,k(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,k(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function xe(e){return b(e==null?void 0:e.getReader)}function F(e){if(e instanceof E)return e;if(e!=null){if(me(e))return on(e);if(Ct(e))return sn(e);if(ge(e))return an(e);if(ye(e))return Ie(e);if(Ae(e))return un(e);if(xe(e))return fn(e)}throw ve(e)}function on(e){return new E(function(t){var n=e[Bt]();if(b(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function sn(e){return new E(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function an(e){return new E(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,ue)})}function un(e){return new E(function(t){var n,r;try{for(var i=R(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function Ie(e){return new E(function(t){cn(e,t).catch(function(n){return t.error(n)})})}function fn(e){return Ie(we(e))}function cn(e,t){var n,r,i,o;return Pe(this,void 0,void 0,function(){var s,a;return re(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=ke(e),u.label=1;case 1:return[4,n.next()];case 2:if(r=u.sent(),!!r.done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function j(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Be(e,t){return t===void 0&&(t=0),B(function(n,r){n.subscribe(I(r,function(i){return j(r,e,function(){return r.next(i)},t)},function(){return j(r,e,function(){return r.complete()},t)},function(i){return j(r,e,function(){return r.error(i)},t)}))})}function Se(e,t){return t===void 0&&(t=0),B(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function ln(e,t){return F(e).pipe(Se(t),Be(t))}function hn(e,t){return F(e).pipe(Se(t),Be(t))}function dn(e,t){return new E(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function pn(e,t){return new E(function(n){var r;return j(n,t,function(){r=e[be](),j(n,t,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){n.error(a);return}s?n.complete():n.next(o)},0,!0)}),function(){return b(r==null?void 0:r.return)&&r.return()}})}function Ce(e,t){if(!e)throw new Error("Iterable cannot be null");return new E(function(n){j(n,t,function(){var r=e[Symbol.asyncIterator]();j(n,t,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function gn(e,t){return Ce(we(e),t)}function mn(e,t){if(e!=null){if(me(e))return ln(e,t);if(Ct(e))return dn(e,t);if(ge(e))return hn(e,t);if(ye(e))return Ce(e,t);if(Ae(e))return pn(e,t);if(xe(e))return gn(e,t)}throw ve(e)}function X(e,t){return t?mn(e,t):F(e)}function yn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Z(e);return X(e,n)}function vn(e){return e instanceof Date&&!isNaN(e)}function x(e,t){return B(function(n,r){var i=0;n.subscribe(I(r,function(o){r.next(e.call(t,o,i++))}))})}var bn=Array.isArray;function An(e,t){return bn(t)?e.apply(void 0,T([],C(t))):e(t)}function wn(e){return x(function(t){return An(e,t)})}function xn(e,t,n,r,i,o,s,a){var u=[],f=0,c=0,h=!1,l=function(){h&&!u.length&&!f&&t.complete()},d=function(m){return f<r?v(m):u.push(m)},v=function(m){o&&t.next(m),f++;var p=!1;F(n(m,c++)).subscribe(I(t,function(g){i==null||i(g),o?d(g):t.next(g)},function(){p=!0},void 0,function(){if(p)try{f--;for(var g=function(){var A=u.shift();s?j(t,s,function(){return v(A)}):v(A)};u.length&&f<r;)g();l()}catch(A){t.error(A)}}))};return e.subscribe(I(t,d,function(){h=!0,l()})),function(){a==null||a()}}function D(e,t,n){return n===void 0&&(n=1/0),b(t)?D(function(r,i){return x(function(o,s){return t(r,o,i,s)})(F(e(r,i)))},n):(typeof t=="number"&&(n=t),B(function(r,i){return xn(r,i,e,n)}))}function N(e){return e===void 0&&(e=1/0),D(J,e)}function In(){return N(1)}function bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return In()(X(e,Z(e)))}var Bn=["addListener","removeListener"],Sn=["addEventListener","removeEventListener"],Cn=["on","off"];function O(e,t,n,r){if(b(n)&&(r=n,n=void 0),r)return O(e,t,n).pipe(wn(r));var i=C(Hn(e)?Sn.map(function(a){return function(u){return e[a](t,u,n)}}):En(e)?Bn.map(kt(e,t)):Tn(e)?Cn.map(kt(e,t)):[],2),o=i[0],s=i[1];if(!o&&Ct(e))return D(function(a){return O(a,t,n)})(F(e));if(!o)throw new TypeError("Invalid event target");return new E(function(a){var u=function(){for(var f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return a.next(1<f.length?f:f[0])};return o(u),function(){return s(u)}})}function kt(e,t){return function(n){return function(r){return e[n](t,r)}}}function En(e){return b(e.addListener)&&b(e.removeListener)}function Tn(e){return b(e.on)&&b(e.off)}function Hn(e){return b(e.addEventListener)&&b(e.removeEventListener)}function Et(e,t,n){e===void 0&&(e=0),n===void 0&&(n=Qe);var r=-1;return t!=null&&(de(t)?n=t:r=t),new E(function(i){var o=vn(e)?+e-n.now():e;o<0&&(o=0);var s=0;return n.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function _t(e,t){return e===void 0&&(e=0),t===void 0&&(t=ut),e<0&&(e=0),Et(e,e,t)}function Xn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Z(e),r=pe(e,1/0),i=e;return i.length?i.length===1?F(i[0]):N(r)(X(i,n)):he}var Fn=Array.isArray;function Mn(e){return e.length===1&&Fn(e[0])?e[0]:e}function Yn(e,t){return t===void 0&&(t=null),t=t??e,B(function(n,r){var i=[],o=0;n.subscribe(I(r,function(s){var a,u,f,c,h=null;o++%t===0&&i.push([]);try{for(var l=R(i),d=l.next();!d.done;d=l.next()){var v=d.value;v.push(s),e<=v.length&&(h=h??[],h.push(v))}}catch(g){a={error:g}}finally{try{d&&!d.done&&(u=l.return)&&u.call(l)}finally{if(a)throw a.error}}if(h)try{for(var m=R(h),p=m.next();!p.done;p=m.next()){var v=p.value;q(i,v),r.next(v)}}catch(g){f={error:g}}finally{try{p&&!p.done&&(c=m.return)&&c.call(m)}finally{if(f)throw f.error}}},function(){var s,a;try{for(var u=R(i),f=u.next();!f.done;f=u.next()){var c=f.value;r.next(c)}}catch(h){s={error:h}}finally{try{f&&!f.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function Rn(e,t,n,r,i){return function(o,s){var a=n,u=t,f=0;o.subscribe(I(s,function(c){var h=f++;u=a?e(u,c,h):(a=!0,c),r&&s.next(u)},i&&function(){a&&s.next(u),s.complete()}))}}function Wt(e){return e<=0?function(){return he}:B(function(t,n){var r=0;t.subscribe(I(n,function(i){++r<=e&&(n.next(i),e<=r&&n.complete())}))})}function On(){return B(function(e,t){e.subscribe(I(t,st))})}function jn(e){return x(function(){return e})}function Ee(e,t){return t?function(n){return bt(t.pipe(Wt(1),On()),n.pipe(Ee(e)))}:D(function(n,r){return F(e(n,r)).pipe(Wt(1),jn(n))})}function Ln(e,t){t===void 0&&(t=ut);var n=Et(e,t);return Ee(function(){return n})}function Pn(e,t){return t===void 0&&(t=J),e=e??Gn,B(function(n,r){var i,o=!0;n.subscribe(I(r,function(s){var a=t(s);(o||!e(i,a))&&(o=!1,i=a,r.next(s))}))})}function Gn(e,t){return e===t}function kn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Z(e),r=pe(e,1/0);return e=Mn(e),B(function(i,o){N(r)(X(T([i],C(e)),n)).subscribe(o)})}function Tt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return kn.apply(void 0,T([],C(e)))}function Ht(e,t){return B(Rn(e,t,arguments.length>=2,!0))}function _n(e,t){return t===void 0&&(t=function(n,r){return n===r}),B(function(n,r){var i=Dt(),o=Dt(),s=function(u){r.next(u),r.complete()},a=function(u,f){var c=I(r,function(h){var l=f.buffer,d=f.complete;l.length===0?d?s(!1):u.buffer.push(h):!t(h,l.shift())&&s(!1)},function(){u.complete=!0;var h=f.complete,l=f.buffer;h&&s(l.length===0),c==null||c.unsubscribe()});return c};n.subscribe(a(i,o)),F(e).subscribe(a(o,i))})}function Dt(){return{buffer:[],complete:!1}}function Wn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Z(e);return B(function(r,i){(n?bt(e,r,n):bt(e,r)).subscribe(i)})}function Dn(e,t,n){var r=b(e)||t||n?{next:e,error:t,complete:n}:e;return r?B(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(I(o,function(u){var f;(f=r.next)===null||f===void 0||f.call(r,u),o.next(u)},function(){var u;a=!1,(u=r.complete)===null||u===void 0||u.call(r),o.complete()},function(u){var f;a=!1,(f=r.error)===null||f===void 0||f.call(r,u),o.error(u)},function(){var u,f;a&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(f=r.finalize)===null||f===void 0||f.call(r)}))}):J}function $n(e,t){return B(function(n,r){var i=t??{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,u=a===void 0?!1:a,f=!1,c=null,h=null,l=!1,d=function(){h==null||h.unsubscribe(),h=null,u&&(p(),l&&r.complete())},v=function(){h=null,l&&r.complete()},m=function(g){return h=F(e(g)).subscribe(I(r,d,v))},p=function(){if(f){f=!1;var g=c;c=null,r.next(g),!l&&m(g)}};n.subscribe(I(r,function(g){f=!0,c=g,!(h&&!h.closed)&&(s?p():m(g))},function(){l=!0,!(u&&f&&h&&!h.closed)&&r.complete()}))})}function At(e,t,n){t===void 0&&(t=ut);var r=Et(e,t);return $n(function(){return r},n)}function Kn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=nn(e);return B(function(r,i){for(var o=e.length,s=new Array(o),a=e.map(function(){return!1}),u=!1,f=function(h){F(e[h]).subscribe(I(i,function(l){s[h]=l,!u&&!a[h]&&(a[h]=!0,(u=a.every(J))&&(a=null))},st))},c=0;c<o;c++)f(c);r.subscribe(I(i,function(h){if(u){var l=T([h],C(s));i.next(n?n.apply(void 0,T([],C(l))):l)}}))})}const Vn=["keydown","keyup"],Te={KeyW:1,KeyS:-1,KeyA:-3,KeyD:3},Un=Object.keys(Te),qn={1:"top",2:"bottomRight",3:"right",4:"topRight","-1":"bottom","-2":"topLeft","-3":"left","-4":"bottomLeft"},Jn=X(Vn.map(e=>O(document,e))).pipe(N(),Ht(({keyDownMap:e},t)=>{e[t.code]=t.type==="keydown";const n=t.type==="keydown"?t.code:"";return{keyDownMap:e,type:t.type,active:n}},{keyDownMap:{}}),x(({keyDownMap:e,type:t,active:n})=>{const r=Un.reduce((i,o)=>e[o]?i+Te[o]:i,0);return{type:t,A:e.KeyJ,B:e.KeyK,direction:qn[r],directionValue:r,active:n}})),Zn=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),tt=e=>{const t=new Image;return t.src=e,O(t,"load").pipe(D(()=>yn(t)))},Nn="/contra/assets/beshotted-15c5c5a8.wav",Qn="/contra/assets/beginning-a59380d5.mp3",zn="/contra/assets/bossBomb-4654a6f9.wav",tr="/contra/assets/start-cd18284e.mp3",er="/contra/assets/death-1940e3ab.wav",nr="data:audio/wav;base64,UklGRlRnAABXQVZFZm10IBAAAAABAAEAIlYAACJWAAABAAgAZGF0YdsIAAB+g4ODfHx8fHx8fHx8fHx8fHx8fHx8fHx8fH19fX19fX19fX19fX19fX19fX2AhYWEhISBfX2FhYWFhYWFhYSEhISEhISEhISEhISEhISEhISEg4ODg4ODg4ODc3N6e3t7e3t0dHR0dHR0dHR1dYWFhYWFhYWFhYWFhISEhISEhIR0dHR0dHR1dXV1dXh9fX19fXqGhoaGhYWFhYWFdXV1dXV1dnZ2dnZ2dnZ2dnd3d4eHh4eHh4eHhnZ2dn1+fn5+foeHh4eGhoaGhoaGhoaGhoaGhoWFhYWFhYWFhYWFdHV1dXV1dXV1hoaGiI2NjY2MeXV1dXV1dXV1doaGhoaGhoWFhXV1dXV1dnZ2dnaGhoaGhoaGhoZ1dnZ2fH19fn5+d3Z2dnZ3d3d3h4eHh4eHh4eHdnZ2d3d3d3d3d3d3d3h4eHh4eHh4eHh7gICAgJCNiIiIiIiIiIiIh4eHh4eHh4d3d3d3d3d3d3d3d3h4fHx8fHx8goWFhYCEhIGFhYeEgoWCgoWDg4GEhYSEg4SAgoODgIKGhICEgoKCgoCBg4GDgYKAgoCCg4OBf4J+hIGHg3+DfoSEhYKBhIKAg4GBgIKCgIGAgYB/g4B/gIWEgYOAgIOCgIJ+g4N+gX2EgYCBgYJ/gIKEgYGAgX6Bf4CBf4GAfoKAfoB/gYJ/gIGAgoCAgH9/gIJ/gIB/gIF/gYJ9f31/gYB+f4B+gX2IhYWFhIGGg4CBfoCEhYOCgoCCfn2AfIKChYSAgYB9goOAfYKCgYB+fn59gX5+fIWAfISEgoKBf4B/f35/e4WBgYN/f4F9gH+Af4GAgH99gH+Afn19f4GBf31+f35/gYR/fn99gYGEgH+BgX6Bf399gYF9f35/fX+AgX98goGCf4F/goJ/foB8f4CAfX+Af31/f32Ag39+gIB/fn+Bf35/fn9+gH2BgICBf3yEf4J/f4F9fYB9fn6Cf4B+fn6FgoKDgH+AfICAf3+Af4GAf4F/f4CAf4B+gICAf4CAf4B/fn9+gX+AgX+AgH+AgH5+f4CAfoB/f3+AgIB+gH+AgH+AgH9/gH9+f4CAgH6Af4B/foCAf3+Af39/f4CAgH9/f4CAf4B+fn6AgICAgIB/f3+AgIB+f3+Af39/f3+Af3+AgIB/gH+Af35/gIB/gIB/f36AgIF/f4CAgIB/gH9/gH9/foCBgX+Af3+AgICAgH+Af39/gH+Af4B/gH9/f39+f4B/gIB/f35/gIGAf4GAgIB/gICAgICAgIB/f3+AgH9/f39/gIB/f39+gICAgICAgICAf4B/foCAgX+AgH9+gH6Af4GAgIB/f39+fn+AgICAgIB+gH+AgH6Af4B+f4CAgICAgIB+f3+AfoCAgX6Af3+Af4B+f3+BgH+Bf4CAf4CAgICAf39+f4CAgH+Af4B/gICAf3+Af39/gH9/gH+Af4CAf35/f4F/f4GAfoB/gYB+gH+Af39+foJ/gn+AgICAgIGAgn6CfoKAgoCAgICBfoB/gYCBgIKAgIF/gX+BfYF/gn+BgYGBf4F/gn+BgIB/gYB/gICBf4B/gX+Cf4CAgIB/gX+Af4B/gYCBf4B/gICAgX6BfoB/gICAf36CgIF+gn6Af4B/gYF/gX2Bf4F+gICBf4CAf4F+gH6BgIB+gX+AgX+CfoB+gH+AgH9/f4J/gYCAfoJ/gH+Af39/f4CAgICCfoGAf4F/gH+Af4F+gH6Af3+Bf4B/gH+AfoB+goB/gICBfoB/gX+Bfn9+gYGAf4CAf4B+gX+Af4B/foF/gX6Bf4B+gH+Bf4B/f4B/gX6AfoB+f4CAgH6AfoJ+gX6Bf4CAf39+gH+Bf4J+f3+BgX+Af4B/gn6Af4F/f4B9gH+CfoGAgH+BgH+Af4F/gH+AfYGAgX5/gH+AfoB9gH6Bf3+AgIB+gH6BfoB/gX1/foGAgIJ/gX+Af4GAf4B/gX6Afn99goB/gIGAf4B/gIB/gH5+gIB/gIB+gH5/f39+f4B/f39/gH5/fn9/fn9+gIB+fn6AgH+AgH9+gYCAgH6AfoCAfoB+f35/f39/fn9/foB+gX5+gICBgIF/f4B/f4B+foCBf4CAf3+Af36Bf4GAgIB/f35/gH9/foF/gH9+f3+Af36Af4B+gICAgX6Bfn+Af4F+gH+AgH+Afn9/f4B+gX6Af3+Af4B/f39+gH+Bf4CAfn9+gX9/f4CAf4B/f4B/gH5/f3+Af4B/gH5+f4CAf4GAf4F+gIGAgH+Af39/f4B/gIB/gH9/foB/gH9+gX9/gICAf4B/f399gH+BgIGAgICAgIB/gH+Af39+f4CAgICBf3+Bf4GAf4F/gIB+gICBfoB/f4B/gH5/f4CAf4B/gH9+gH+AfoB/f35+gIF/f4CAgIB/gIF/gH6Af36Af4CAgH9/gH1/f4F/f4F/gH9+gICCf4CAgIF/foCAgYB/gIB/gX9/gH6Af39+f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/fw==",rr="/contra/assets/obtainWeapon-781ea0f8.wav",ir="/contra/assets/missioncomplete-9f9a7546.mp3",or="/contra/assets/f_gun-a973d80d.wav",sr="/contra/assets/m_gun-76b82c1f.wav",ar="/contra/assets/s_gun-004135b6.wav",ur="/contra/assets/you_are_not_prepared-f5e13cad.mp3",fr="/contra/assets/lup-35add116.mp3",cr="/contra/assets/stone_landing-208fa74c.wav",lr="/contra/assets/gameover-b49c8119.mp3",hr="/contra/assets/level_1-033063a9.mp3",dr="/contra/assets/chang-0dbf8678.mp3",pr="/contra/assets/hahaha-cf1413e4.mp3",gr="/contra/assets/ji-a05f5add.mp3",mr="/contra/assets/lanqiu-4325bd06.mp3",yr="/contra/assets/ngmhhy-dab9a5af.mp3",vr="/contra/assets/rap-c3875c4d.mp3",br="/contra/assets/tiao-1cd36d6c.mp3",Ar="/contra/assets/ay-594f45e5.mp3",wr="/contra/assets/jntm-2016e941.mp3",xr={beshotted:Nn,bossBomb:zn,start:tr,death:er,jumpping:nr,obtainWeapon:rr,gunF:or,gunM:sr,gunS:ar,stone_landing:cr,gameover:lr,lup:fr,youarenotprepared:ur,missioncomplete:ir,chang:dr,hahaha:pr,ji:gr,lanqiu:mr,ngmhhy:yr,rap:vr,tiao:br,ay:Ar,jntm:wr},Ir={mainTitle:hr,beginning:Qn},Br="/contra/assets/ground-4c1b690a.png",Sr="/contra/assets/mountains-658f26c2.jpg",Cr="/contra/assets/loading-00317da3.png",He="/contra/assets/contra-4b87243c.png",Xe="/contra/assets/bullets-e6fee74b.png",Er="/contra/assets/level-1-e1cc5b54.jpg",Tr={audios:xr,music:Ir,layers:{background:Er,sprite:[{name:"mainSprite",image:He},{name:"bullets",image:Xe}],tiles:[{name:"mountains",image:Sr,position:[[50,200,2]]},{name:"ground",image:Br,position:[[0,600,100]]},{name:"start",image:Cr,position:[[0,0]]}]}};class Hr{constructor(t){this.buffers={},this.context=t}addAudio(t,n){this.buffers[t]=n}playAudio(t,n,r){const i=this.buffers[t];r&&i.pause&&i.pause();const o=this.context.createBufferSource();o.connect(this.context.destination),o.buffer=i,o.start(0),o.loop=!!n,i.pause=()=>{o.stop(0)}}pauseAll(){Object.values(this.buffers).forEach(t=>{t.pause()})}}const $t=e=>{const t=new AudioContext,n=new Hr(t),r=Object.keys(e).map(i=>fetch(e[i]).then(o=>o.arrayBuffer()).then(o=>t.decodeAudioData(o)).then(o=>n.addAudio(i,o)));return X(Promise.all(r)).pipe(x(()=>n))},Xt="LOAD_SOURCE",Kt="START_PAGE",Vt="START_PAGE_ANIMATION",Ut="START_PAGE_COMPLETE",qt="START_PAGE_BLINK",Jt="LEVEL_1",U=(e,t,n,r,i,o)=>{const s=document.createElement("canvas");s.width=i,s.height=o;const a=s.getContext("2d");return t&&(a.scale(-1,1),a.translate(-i,0)),a.drawImage(e,n,r,i,o,0,0,i,o),s},et=e=>{const{url:t,frames:n,animations:r,tiles:i}=e;return Zn(t).then(o=>new Promise(s=>{const a=Object.keys(r).reduce((u,f)=>{const c=r[f];return typeof c=="string"&&c.startsWith("-")?u[f]=r[c.slice(1)].map(h=>U(o,!0,...n[h])):u[f]=r[f].map(h=>U(o,!1,...n[h])),u},{});s({image:o,animations:a,tiles:Object.keys(i).reduce((u,f)=>(u[f]=U(o,!1,...i[f]),u),{})})}))},Xr="/contra/assets/enemySprite-e6a65ebf.png",wt={url:Xr,frames:{"run-1":[45,41,19,31],"run-2":[65,42,17,31],"run-3":[84,43,18,31],"run-4":[103,41,19,31],"run-5":[123,42,18,31],"bird-man":[15,184,26,47],"shot-1":[90,74,25,31],"shot-2":[70,9,24,31],cannon:[76,262,32,31]},animations:{runningman:["run-1","run-2","run-3","run-4","run-5"],birdman:["bird-man"],shot1:["shot-1"],shot2:["shot-2"],shotRight:"-shot2",cannon:["cannon"]},tiles:[]};function Fr(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function Mr(e){const{music:t,layers:n,audios:r}=Tr,i=[...n.tiles.map(l=>tt(l.image).pipe(x(d=>({image:d,name:l.name,width:d.width,height:d.height,position:l.position,buffer:Fr(d)})),x(d=>({...d,type:"image"}))))],o=[...n.sprite.map(l=>tt(l.image).pipe(x(d=>({image:d,name:l.name,type:"sprite"}))))],s=[tt(n.background).pipe(x(l=>({image:l,buffer:U(l,0,0,0,l.width,l.height),width:l.width,height:l.height,name:"background",type:"background"})))];tt(wt.url).pipe(x(l=>({image:l,buffer:U(l,0,0,0,l.width,l.height),width:l.width,height:l.height,name:"enemy",type:"enemy",config:wt})));const a=X($t(t)).pipe(x(l=>({music:l,type:"music",name:"mainTitle"}))),u=X($t(r)).pipe(x(l=>({audio:l,type:"audio",name:"soundEffects"}))),f=[...i,...s,...o,a,u],c=f.length;let h=0;return X(f).pipe(N(),x(l=>({value:l,type:Xt,loadedCount:++h,total:c})))}function nt(e,t){return e.width&&e.height&&e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function Yr(e,t){return function(n){return n.x>=0&&n.x<e&&n.y>=0&&n.y<t}}function Rr({ctx:e,img:t,imgWidth:n,imgHeight:r,startPos:{x:i,y:o},endPos:{x:s,y:a},duration:u,rect:f,done:c}){const h=performance.now();return function(){const d=performance.now()-h,v=f||[n,r],m=Math.min(d/u,1),p=i+(s-i)*m,g=o+(a-o)*m;e.drawImage(t,0,0,n,r,p,g,...v),m<1||c&&c()}}const Or=({draw:e,interval:t=500,duration:n,done:r})=>{const i=performance.now();return function(){const o=performance.now()-i;Math.min(o/n,1)<1?Math.floor(o/t)%2&&e():r&&r()}},w=()=>window.performance.now(),jr=(e,t)=>{const n=t.contraSpirte.animations.life[0],r=20,i=20,o=16,s=Math.min(t.lifes,4);Array(s).fill(0).forEach((a,u)=>{e.drawImage(n,r+o*u,i)})},dt=e=>{const t=[];for(let n=0;n<e.length;n++){let r=e[n];r.remove?(r.destory&&r.destory(),r=null):t.push(r)}return t},Lr=(e,t,n,r,i)=>{const o=r/i,s=t/n;let a,u=0;o>s?a=t/r:(a=n/i,u=Math.floor((t-r*a)/2)),e.style.transform=`translate3d(${u}px, 0, 0) scale3d(${a}, ${a}, 1)`};function Pr(e,t,n,r,i,o,s=1){o&&(e.strokeStyle=o),e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.stroke(),e.lineWidth=s}const Gr=(e,t,n,r=1)=>{e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.strokeStyle=n,e.lineWidth=r,e.stroke()},pt=(e,t,n,r,i,o)=>{e.fillStyle=o,e.fillRect(t,n,r,i)},kr=(e,t,n)=>{if(t>0){const r=["red","yellow","blue","green","red"],a=Math.floor(t/10),u=t%10,f=n.width,c=a%4,h=f-100-10,l=[h,10,100,5],d=[h,10,100*u/10,5];pt(e,...l,"black"),a>0&&pt(e,...l,r[c]),pt(e,...d,r[c+1]),a>0&&(e.fillStyle="#fff",e.fillText("x "+a,h,30))}},_r={url:He,frames:{"run-1":[0,42,17,36],"run-2":[17,42,20,36],"run-3":[17,42,20,36],"run-4":[58,43,17,35],"run-5":[75,43,19,35],"run-6":[94,46,21,32],"jump-1":[116,51,17,21],"jump-2":[134,53,21,17],"jump-3":[156,51,17,21],"jump-4":[174,53,21,17],"shot-1":[0,7,24,35],"shot-2":[24,8,24,34],"shot-3":[48,0,15,43],"shot-4":[63,0,15,42],"shot-5":[78,24,33,17],"shot-6":[111,25,33,17],"run-shot-1":[0,78,24,35],"run-shot-2":[24,78,26,35],"run-shot-3":[50,80,26,33],"die-1":[77,93,24,16],"die-2":[103,89,16,24],"die-3":[121,93,24,16],"die-4":[147,89,16,24],"die-5":[167,102,33,11],"top-right-1":[0,148,17,36],"top-right-2":[17,148,20,36],"top-right-3":[37,150,21,34],"bottom-right-1":[0,220,21,36],"bottom-right-2":[21,220,22,36],"bottom-right-3":[43,222,22,34],gunM:[96,8,7,7],life:[192,0,9,16]},animations:{bottomRight:["bottom-right-1","bottom-right-2","bottom-right-3"],bottomLeft:"-bottomRight",topRight:["top-right-1","top-right-2","top-right-3"],topLeft:"-topRight",die:["die-1","die-2","die-3","die-4","die-5"],runShot:["run-shot-1","run-shot-2","run-shot-3"],forward:["shot-1"],backward:"-forward",forwardShot:["shot-1","shot-2"],top:["shot-3"],leftTop:"-top",topShot:["shot-3","shot-4"],bottom:["shot-5"],leftBottom:"-bottom",downShot:["shot-5","shot-6"],right:["run-1","run-2","run-3","run-4","run-5","run-6"],left:"-right",jumpping:["jump-1","jump-2","jump-3","jump-4"],life:["life"]},tiles:{gunM:[96,8,7,7],gunN:[81,9,4,4]}},Wr={url:Xe,frames:[],animations:[],tiles:{origin:[99,17,25,15],eagleM:[0,0,24,15],eagleS:[49,0,25,15],eagleR:[74,0,25,15]}},Dr=(e,t,n,r)=>{const i=n-e,o=r-t;return 360-(Math.atan2(o,i)*(180/Math.PI)+360)%360},Fe={top:90,bottomRight:315,right:0,topRight:45,bottom:270,topLeft:135,left:180,bottomLeft:225};class Ft{constructor({ctx:t,buffer:n,direction:r,speed:i,name:o,angle:s,x:a,y:u,canvasWidth:f,canvasHeight:c}){this.ctx=t,this.buffer=n,this.direction=r,this.x=a,this.y=u,this.name=o,this.width=this.buffer.width,this.height=this.buffer.height,this.canvasWidth=f,this.canvasHeight=c,this.speed=i||10,this.angle=s||Fe[r||"right"],this.radians=this.angle*Math.PI/180,this.damage=1,this.remove=!1}get rect(){return{x:this.x,y:this.y,width:this.width,height:this.height}}update(){this.x+=this.speed*Math.cos(this.radians),this.y+=-this.speed*Math.sin(this.radians),this.x>0&&this.x<this.canvasWidth&&this.y>0&&this.y<this.canvasHeight?this.ctx.drawImage(this.buffer,this.x,this.y):this.remove=!0}}const $r=e=>{const t=Fe[e.direction||0],n=15;return[-2,-1,0,1,2].map(i=>t+i*n).map(i=>new Ft({...e,angle:i}))},ft=(e,t,n,r)=>{const i=e.contra,o=n||Dr(t.x,t.y,i.x,i.y);return new Ft({angle:o,buffer:r||e.contraSpirte.tiles.gunN,x:t.x,y:t.y,speed:3,name:t.name,ctx:e.ctx,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight})};class Kr{constructor({frames:t}){this.ready=0,this.startTime=0,this.interval=100,this.velocity=.4,this.frames=t,this.framesLen=t.length}start(t,n){t.jumpping||(t.sounds.playAudio("jumpping"),t.jumpping=!0,t.speedY=n||-5.5,this.startTime=w())}getFrame(){const t=w()-this.startTime,r=Math.floor(t/this.interval)%this.framesLen;return this.frames[r]}update(t){t.jumpping&&(t.y+=t.speedY,t.speedY+=this.velocity)}}class Vr{constructor(){this.startTime=0,this.interval=100,this.speed=2,this.velocity=1,this.lastDirectionValue=3}start(t){}getFrame(t){const n=w()-this.startTime,i=Math.floor(n/this.interval)%t.length;return t[i]}update(t,n,r){const i=n.directionValue;this.direction=n.direction,i>=2?t.x+=this.speed:i<=-2&&(t.x-=this.speed),i!==this.lastDirectionValue&&(this.lastDirectionValue=i,this.startTime=w())}}class Mt{constructor(t={}){this.groundCoordinates=t.groundCoordinates,this.velocity=t.velocity||1}getLandingResult(t,n,r,i){for(let o=0;o<this.groundCoordinates.length;o++){const s=this.groundCoordinates[o],{type:a,start:u,end:f,h:c}=s;if(t>=u+i.deltaX&&t<=f+i.deltaX&&n<=c&&r>=c)return{type:!0,h:c,land:s}}return{type:!1}}update(t,n,r,i){const o=t.y+t.height,s=o+t.speedY,a=this.getLandingResult(t.x,o,s,i);t.jumpping||t.falling?a.type&&t.landed(a.h,a.land):a.type||t.setFall&&t.setFall()}}class L{constructor(){this.events=[],this.x=0,this.y=0,this.traits={},this.hp=1,this.remove=!1}get rect(){return{x:this.x,y:this.y,width:this.width,height:this.height}}addTrait(t,n){this.traits[t]=n}getTrait(t){return this.traits[t]}getAllTraits(){return Object.keys(this.traits).map(t=>this.getTrait(t))}update(t,n){Object.keys(this.traits).forEach(r=>{this.traits[r].update(this,t,n)}),this.update(t,n)}}function Zt(){const e=({ctx:r,keyboard:i,entity:o,animations:s,jumpTrait:a,moveTrait:u})=>{const f=i.direction||"";if(f.includes("ight")?o.face="right":f.includes("eft")&&(o.face="left"),o.jumpping)return o.setJumpRect(),a.getFrame();if(f){let h=f;return o.face==="left"&&(f==="top"?h="leftTop":f==="bottom"&&(h="leftBottom")),u.getFrame(s[h])}const c=o.face==="right"?"forward":"backward";return s[c][0]},t=new _,n=new _;return function(r){const i=r.data||{},o=r.image.animations,s=new L;s.addTrait("jump",new Kr({frames:r.image.animations.jumpping})),s.addTrait("move",new Vr),s.addTrait("landing",new Mt({groundCoordinates:i.groundCoordinates})),s.x=r.x,s.y=r.y,s.originWidth=24,s.originHeight=34,s.width=0,s.height=0,s.sounds=r.sounds,s.image=r.image,s.face="right",s.type=1,s.name="contra",s.dying=!1,s.weaponType=i.cheats?2:1,s.bornTime=w(),s.invincible=!0,s.bottomWidth=33,s.bottomHeight=17,s.bottomY=s.originHeight-s.bottomHeight,s.crawling=!1,s.lastDirection="";const a=i.mainData$;s.resetRect=()=>{s.width=s.originWidth,s.height=s.originHeight},s.setJumpRect=()=>{s.width=20,s.height=20},s.setCrawRect=()=>{s.width=33,s.height=17},setTimeout(()=>{s.invincible=!1},2e3),t.pipe(At(200)).subscribe(c=>{s.sounds.playAudio(s.weaponType===2?"gunS":"gunM");const h=s.weaponType===2?$r(c):[new Ft(c)];a.next({contraBullets:i.contraBullets.concat(h).filter(l=>!l.remove)})}),s.landed=(c,h)=>{s.resetRect(),s.jumpping=!1,s.y=c-s.originHeight,s.land=h};const u=s.getTrait("jump"),f=s.getTrait("move");return s.setFall=c=>{c&&(s.y+=20),u.start(s,-1)},s.godie=()=>{!s.dying&&!s.remove&&!s.invincible&&(s.sounds.playAudio("death"),s.dying=!0,setTimeout(()=>{s.remove=!0},1e3))},n.pipe(At(200)).subscribe(c=>{s.setFall(c)}),n.next(),s.fall$=n,s.update=(c,h)=>{var l;if(h.active==="KeyL"&&s.sounds.playAudio("youarenotprepared",!1,!0),!s.dying){i.inScreen(s)||s.godie();const v=h.direction||"";h.B&&(v.includes("ottom")?(l=s.land)!=null&&l.fallDisabled||n.next(!0):u.start(s)),s.getAllTraits().forEach(H=>{H.update(s,h,o,i)});const m=e({ctx:c,keyboard:h,entity:s,animations:o,jumpTrait:u,moveTrait:f});if(h.A){let H=v;(v==="bottom"&&!s.jumpping||!v)&&(H=s.face),t.next({buffer:r.image.tiles.gunM,x:s.x,y:s.y+8,direction:H,ctx:c,canvasWidth:i.canvasWidth,canvasHeight:i.canvasHeight})}const p=Math.floor(i.width/2),g=-i.backgroundWidth+i.width;let A;if(v.includes("ight")&&s.x>p){const H=s.x-p;A=Math.max(i.deltaX-H,g),a.next({deltaX:A})}A===g||g===i.deltaX?s.x=Math.max(s.x,20):s.x=Math.min(Math.max(s.x,20),p),v==="bottom"&&s.lastDirection!==v?(s.setCrawRect(),s.y+=s.bottomY):v!=="bottom"&&s.lastDirection==="bottom"&&(s.resetRect(),s.y-=s.bottomY),s.lastDirection=v,!(s.invincible&&Math.floor((w()-s.bornTime)/100)%2)&&c.drawImage(m,s.x,s.y)}i.contraBullets.forEach(d=>{d.update()})},s}}const Ur=function(e){const t=e.eagle.tiles;return n=>new qr(t,n,e)};class qr extends L{constructor(t,n=2,r){super(),this.speedX=2.5,this.speedY=-2,this.x=0,this.y=40,this.originY=this.y,this.delta=20,this.buffers=t,this.buffer=t.origin,this.weaponType=n,this.gunBuffer=n===2?t.eagleS:t.eagleM,this.width=25,this.height=15,this.type=2,this.status=2,this.name="weapon",this.falling=!0,this.data=r,this.addTrait("landing",new Mt({groundCoordinates:r.groundCoordinates}))}landed(t){this.y=t-this.height,this.speedY=0,this.falling=!1}airborne(){this.status=1,this.deltaX=this.data.deltaX}update(t,n,r){this.status>0&&(this.falling&&(this.x+=this.speedX,this.y+=this.speedY),this.remove=!r.inScreen(this),this.status===2?Math.abs(this.y-this.originY)>this.delta&&(this.speedY*=-1):this.status===1&&(this.speedX=0,this.speedY=3,this.x+=r.deltaX-this.deltaX,this.deltaX=r.deltaX,this.buffer=this.gunBuffer,this.getTrait("landing").update(this,n,null,r)),t.drawImage(this.buffer,this.x,this.y))}destory(){this.status=0,this.remove=!0}}function Jr(e){return t=>{const n=new L;n.x=t.x,n.y=t.y,n.type=2,n.update=(r,i,o)=>{r.drawImage(o.enemySprite.animations.birdman,n.x,n.y)}}}const Zr="/contra/assets/kun_sprite-071a3c63.png",Nr={url:Zr,frames:{"run-1":[130,2,30,40],"run-2":[169,2,27,40],"jump-1":[87,2,30,39],"jump-2":[52,0,28,42],basketball:[0,6,33,32]},animations:{run:["run-1","run-2"],leftRun:"-run",jump1:["jump-1"],jump2:["jump-2"],basketball:["basketball"]},tiles:[]},Qr=(e,t)=>e.start-t.start,zr=[{type:"land",start:20,end:740,h:110},{type:"land",start:150,end:256,h:145},{type:"land",start:245,end:288,h:176},{type:"land",start:280,end:350,h:205},{type:"land",start:340,end:387,h:176},{type:"land",start:406,end:481,h:145},{type:"land",start:570,end:641,h:205},{type:"land",start:600,end:707,h:160},{type:"land",start:856,end:1026,h:110},{type:"land",start:1142,end:1410,h:110},{type:"land",start:1335,end:1858,h:80},{type:"land",start:1370,end:1475,h:210},{type:"land",start:1463,end:1538,h:160},{type:"land",start:1560,end:1795,h:144},{type:"land",start:1688,end:1891,h:210},{type:"land",start:1815,end:2051,h:110},{type:"land",start:1880,end:1954,h:175},{type:"land",start:1975,end:2051,h:175},{type:"land",start:2010,end:2178,h:80},{type:"land",start:2073,end:2113,h:160},{type:"land",start:2135,end:2241,h:145},{type:"land",start:2210,end:2274,h:115},{type:"land",start:2295,end:2370,h:145},{type:"land",start:2295,end:2337,h:210},{type:"land",start:2325,end:2433,h:180},{type:"land",start:2422,end:2500,h:115},{type:"land",start:2455,end:2530,h:80},{type:"land",start:2455,end:2500,h:210},{type:"land",start:2490,end:2530,h:160},{type:"land",start:2550,end:2625,h:110},{type:"land",start:2580,end:2752,h:140},{type:"land",start:2680,end:2785,h:208},{type:"land",start:2808,end:2880,h:176},{type:"land",start:2900,end:2980,h:145},{type:"land",start:2966,end:3135,h:115},{type:"land",start:2966,end:3246,h:210},{type:"land",start:3e3,end:3135,h:160},{type:"land",start:3125,end:3167,h:145},{type:"land",start:3157,end:3200,h:178},{type:"water",start:0,end:1743,h:221,fallDisabled:!0}].sort(Qr),Nt=[{type:"birdman",x:1e3,y:10},{type:"birdman",x:2e3,y:10},{type:"cannon",x:500,y:110},{type:"cannon",x:550,y:110},{type:"cannon",x:600,y:110},{type:"runningman",x:450,y:110},{type:"runningman",x:500,y:110},{type:"runningman",x:550,y:110},{type:"runningman",x:1300,y:110},{type:"runningman",x:1350,y:110},{type:"runningman",x:1400,y:110},{type:"runningman",x:1700,y:144},{type:"runningman",x:1400,y:80},{type:"runningman",x:1450,y:80},{type:"runningman",x:1500,y:80},{type:"runningman",x:1550,y:80},{type:"runningman",x:1600,y:80},{type:"runningman",x:1650,y:80},{type:"runningman",x:1700,y:80},{type:"runningman",x:1750,y:80},{type:"runningman",x:1800,y:80},{type:"runningman",x:950,y:110},{type:"gunner",x:320,y:205},{type:"gunner",x:610,y:205},{type:"gunner",x:1e3,y:110},{type:"gunner",x:1330,y:110},{type:"gunner",x:1460,y:210},{type:"gunner",x:1800,y:210},{type:"gunner",x:2100,y:160},{type:"gunner",x:2320,y:210},{type:"gunner",x:2490,y:210},{type:"gunner",x:2750,y:210},{type:"gunner",x:2790,y:210},{type:"eagle",x:100,bulletType:2},{type:"eagle",x:500,bulletType:2},{type:"eagle",x:1e3,bulletType:2},{type:"eagle",x:1500,bulletType:2},{type:"eagle",x:2e3,bulletType:2},{type:"eagle",x:2500,bulletType:2},{type:"eagle",x:3e3,bulletType:2},{type:"kun",x:3300,y:100}].sort((e,t)=>e.x-t.x),ti=()=>{const e=new _;return e.pipe(At(200)).subscribe(({keyboard:t,data:n})=>{t.active==="ArrowUp"&&(n.source.soundEffects.audio.playAudio("lup"),n.mainData$.next({lifes:n.lifes+1}))}),e};class ei extends L{constructor(t,n){super(),this.speedX=0,this.delta=20,this.buffer=t.enemySprite.animations.birdman[0],this.width=this.buffer.width,this.height=this.buffer.height,this.x=t.width-50,this.y=n.y-1,this.originY=this.y,this.half=t.width/2,this.type=2,this.name="birdman",this.hp=50,this.score=10,this.data=t,this.audio=t.source.soundEffects.audio,this.startMoveTime=w(),this.startBulletTime=w(),this.moveInterval=2e3,this.nextMoveInterval=2500,this.bulletInterval=1e3,this.scored=!1}destory(){this.remove=!0}hurt(t,n){this.audio.playAudio("beshotted"),this.hp-=t,this.hp<=0&&(this.scored||(n(),this.scored=!0),this.destory())}shot(t){const n=t.enemyBullets.concat(ft(t,this));t.mainData$.next({enemyBullets:n})}update(t,n,r){const i=w();i-this.startBulletTime>this.bulletInterval&&(this.startBulletTime=i,this.shot(r));const o=i-this.startMoveTime;if(o>this.moveInterval&&o<this.nextMoveInterval)this.speedX=0;else if(o>this.nextMoveInterval){this.startMoveTime=i;const s=Math.floor(Math.random()*this.half),a=Math.min(s,this.half/2),u=this.x<this.half?this.x+a:this.x-a;this.speedX=Math.floor((u-this.x)/(this.moveInterval/r.FPS)/2)}this.x+=this.speedX,r.inScreen(this)||this.destory(),t.drawImage(this.buffer,this.x,this.y)}}class ni extends L{constructor(t,n){super(),this.speedX=0,this.buffer=t.enemySprite.animations.cannon[0],this.width=this.buffer.width,this.height=this.buffer.height,this.config=n,this.x=t.deltaX+n.x-this.width,this.y=n.y-this.height,this.type=2,this.name="cannon",this.hp=5,this.score=5,this.data=t,this.audio=t.source.soundEffects.audio,this.startBulletTime=w(),this.bulletInterval=1e3,this.scored=!1}destory(){this.remove=!0}hurt(t,n){this.audio.playAudio("beshotted"),this.hp-=t,this.hp<=0&&(this.scored||(n(),this.scored=!0),this.destory())}shot(t){const n=t.enemyBullets.concat(ft(t,this,180));t.mainData$.next({enemyBullets:n})}update(t,n,r){const i=w();i-this.startBulletTime>this.bulletInterval&&(this.startBulletTime=i,this.shot(r)),this.x=r.deltaX+this.config.x,r.inScreen(this)||this.destory(),t.drawImage(this.buffer,this.x,this.y)}}class ri extends L{constructor(t,n){super(),this.speedX=-2,this.speedY=2,this.buffers=t.enemySprite.animations.runningman,this.bufferLength=this.buffers.length,this.buffer=this.buffers[0],this.width=this.buffer.width,this.height=this.buffer.height,this.x=n.x+t.deltaX,this.y=n.y-this.height,this.type=2,this.name="runningman",this.hp=1,this.score=2,this.data=t,this.audio=t.source.soundEffects.audio,this.startMoveTime=w(),this.scored=!1,this.addTrait("landing",new Mt({groundCoordinates:t.groundCoordinates})),this.lastDeltaX=t.deltaX}destory(){this.remove=!0}hurt(t,n){this.hp-=t,this.hp<=0&&(this.scored||(n(),this.scored=!0),this.destory())}setFall(){this.y+=5}update(t,n,r){const o=w()-this.startMoveTime,s=Math.floor(o/200%this.bufferLength);this.x+=this.speedX-this.lastDeltaX+r.deltaX,this.lastDeltaX=r.deltaX,r.inScreen(this)||this.destory(),this.getAllTraits().forEach(a=>{a.update(this,n,this.buffers,r)}),t.drawImage(this.buffers[s],this.x,this.y)}}class ii extends L{constructor(t,n){super(),this.speedX=0,this.buffer=t.enemySprite.animations.shot2[0],this.bufferRight=t.enemySprite.animations.shotRight[0],this.width=this.buffer.width,this.height=this.buffer.height,this.configX=n.x-this.width,this.x=t.deltaX+n.x-this.width,this.y=n.y-this.height,this.type=2,this.name="gunner",this.hp=1,this.score=5,this.data=t,this.audio=t.source.soundEffects.audio,this.startBulletTime=w(),this.bulletInterval=1e3,this.scored=!1}destory(){this.remove=!0}hurt(t,n){this.hp-=t,this.hp<=0&&(this.scored||(n(),this.scored=!0),this.destory())}shot(t){const n=t.enemyBullets.concat(ft(t,this));t.mainData$.next({enemyBullets:n})}update(t,n,r){const i=w();i-this.startBulletTime>this.bulletInterval&&(this.startBulletTime=i,this.shot(r)),r.inScreen(this)||this.destory(),this.x=r.deltaX+this.configX;const o=this.x>r.contra.x?this.buffer:this.bufferRight;t.drawImage(o,this.x,this.y)}}class oi extends L{constructor(t,n){super(),this.speedX=0,this.speedY=2,this.delta=20,this.buffer=t.kunSprite.animations.run[0],this.width=this.buffer.width,this.height=this.buffer.height,this.basket=t.kunSprite.animations.basketball[0],this.x=t.deltaX+n.x-this.width,this.y=n.y-1,this.type=2,this.name="kun",this.hp=250,this.score=10,this.data=t,this.audio=t.source.soundEffects.audio,this.startMoveTime=w(),this.startBulletTime=w(),this.moveInterval=2e3,this.nextMoveInterval=2500,this.bulletInterval=1e3,this.scored=!1,this.now=w(),this.skills={chang:{cd:5e3,audio:"jntm"},tiao:{cd:4e3,audio:"tiao"},rap:{cd:1e3,audio:"ji"},lanqiu:{cd:1e4,audio:"lanqiu"}},console.log("ikun"),this.audio.playAudio("jntm")}destory(){this.remove=!0,this.data.source.mainTitle.music.pauseAll(),this.audio.playAudio("ngmhhy"),setTimeout(()=>{this.audio.playAudio("missioncomplete")},4e3)}hurt(t,n){this.audio.playAudio("ay"),this.hp-=t*2,this.hp<=0&&(this.scored||(n(),this.scored=!0),this.destory())}shot(t){this.audio.playAudio("ji");const n=t.enemyBullets.concat(ft(t,this,null,this.basket));t.mainData$.next({enemyBullets:n})}getKill(){}update(t,n,r){const i=r.contra;this.face=this.x>i.x?"left":"right",this.getKill();const o=w();o-this.startBulletTime>this.bulletInterval&&(this.startBulletTime=o,this.shot(r));const s=o-this.startMoveTime;if(s>this.moveInterval&&s<this.nextMoveInterval)this.speedX=0;else if(s>this.nextMoveInterval){this.startMoveTime=o;const a=Math.floor(Math.random()*this.half),u=Math.min(a,this.half/2),f=this.x<this.half?this.x+u:this.x-u;this.speedX=Math.floor((f-this.x)/(this.moveInterval/r.FPS)/2)}t.drawImage(this.buffer,this.x,this.y)}}const si=(()=>{let e=0;return t=>{const n=t.updates;let r=!1;for(let i=e;i<Nt.length;i++){const o=Nt[i];if(o.x<=t.width-t.deltaX){let s=null;switch(o.type){case"eagle":s=t.createEagles(o.bulletType);break;case"cannon":s=new ni(t,o);break;case"birdman":s=new ei(t,o);break;case"runningman":s=new ri(t,o);break;case"gunner":s=new ii(t,o);break;case"kun":s=new oi(t,o);break}s&&(n.push(s),r=!0),e=i+1}}r&&t.mainData$.next({updates:n})}})(),ai=X(["top","top","bottom","bottom","left","right","left","right","KeyB"]),ot=new _;let gt=!1;const ui=ot.pipe(Pn((e,t)=>{let n=!1;return e===t?["top","bottom"].includes(t)?(gt&&(n=!0),gt=!0):n=!0:gt=!1,n}),Yn(9,1),D(e=>X(e).pipe(_n(ai)))),Qt=function(e){const n=e.source.start.buffer;e.ctx.drawImage(n,0,0,n.width,n.height,0,0,300,225)},zt=function(e,t,n){e.font="16px sans-serif",e.fillStyle="#fff",e.fillText("点击A或键盘J键开始",t/2-80,n-30)},te=(e,t,n)=>{e.source.mainTitle.music.playAudio(t,n)},fi=(e,t)=>{e.source.soundEffects.audio.playAudio(t)},ci=([e,t,n])=>{const{ctx:r,clear:i,width:o,height:s,type:a,source:u,mainData$:f,canvasWidth:c,canvasHeight:h,updates:l,deltaX:d}=t;i();const m={[Xt]:()=>{const p=u==null?void 0:u.loadedCount,g=u==null?void 0:u.total;let A=0;g&&p&&(A=Math.floor(p/g*100)),r.font="bold 24px verdana, sans-serif",r.fillStyle="#fff",r.fillText(`${A}%`,o/2-30,s/2),A===100&&(console.log("data",t),et(Wr).then(S=>{f.next({eagle:S})}),et(wt).then(S=>{f.next({enemySprite:S})}),et(Nr).then(S=>{f.next({kunSprite:S})}),et(_r).then(S=>{f.next({contraSpirte:S})}),f.next({type:Kt,groundCoordinates:zr}),te(t,"beginning"))},[Kt]:()=>{const p=t.source.start,g=Rr({ctx:r,img:p.buffer,imgWidth:p.width,imgHeight:p.height,startPos:{x:300,y:0},endPos:{x:0,y:0},duration:2e3,done:()=>{f.next({type:Ut})},rect:[300,225]});f.next({startLoading:g,type:Vt})},[Vt]:()=>{const p=t.startLoading;p&&p()},[Ut]:()=>{if(Qt(t),zt(r,o,s),n!=null&&n.direction&&ot.next(n.direction),(n!=null&&n.A||n!=null&&n.B)&&(n.A?ot.next("KeyA"):n.B&&ot.next("KeyB")),n!=null&&n.A){fi(t,"start");const p=Or({draw:()=>{zt(r,o,s)},interval:300,duration:1500,done:()=>{const g=Zt()({y:20,x:40,sounds:u.soundEffects.audio,image:t.contraSpirte,keyboard:n,data:t});window.contra=g,window.data=t,console.log("window.contra",g),console.log("window.data",t);const A=Ur(t),S=Jr();f.next({type:Jt,createEagles:A,contra:g,createEnemy:S,updates:t.updates.concat(g),lupHandler:ti()}),te(t,"mainTitle",!0)}});f.next({startBlink:p,type:qt})}},[qt]:()=>{Qt(t);const p=t.startBlink();p&&p()},[Jt]:()=>{const p=t.contra,g={x:p.x,y:p.y,width:p.width,height:p.height},A=t.source.background;let S=t.score;r.drawImage(A.buffer,0,0,A.width,A.height,t.deltaX,0,A.width,A.height),t.updates.forEach(y=>{t.contraBullets.forEach(P=>{if(y.type===2){const Ot=nt(y.rect,P.rect);y.name==="weapon"&&y.status!==1?Ot&&(y.airborne(),P.remove=!0):Ot&&(P.remove=!0,y.hurt&&y.hurt(P.damage,()=>{S+=y.score||1}),y.hp>1&&f.next({enemyHpEntity:y}))}}),y.name==="weapon"&&y.status===1&&nt(g,y)&&(y.destory(),p.sounds.playAudio("obtainWeapon"),p.weaponType=y.weaponType)}),t.enemyBullets.forEach(y=>{nt(g,y)&&p.godie()}),t.updates.forEach(y=>{y.type===2&&y.name!=="weapon"&&nt(g,y)&&p.godie()}),si(t),jr(r,t),t.lupHandler.next({keyboard:n,data:t}),t.enemyBullets.forEach(y=>y.update(r,n,t));const H=t.updates;H.forEach(y=>y.update(r,n,t));let ct=t.lifes;if(t.enemyHpEntity&&!t.enemyHpEntity.remove&&t.enemyHpEntity.hp>0&&kr(r,t.enemyHpEntity.hp,t),p.remove)if(ct>0){const y=Zt()({y:20,x:40,sounds:u.soundEffects.audio,image:t.contraSpirte,keyboard:n,data:t});H.push(y),f.next({contra:y}),ct-=1}else t.source.mainTitle.music.pauseAll(),p.sounds.playAudio("gameover"),t.stream$.unsubscribe();f.next({updates:H,lifes:ct,score:S}),r.fillText("分数:"+S,10,10),window.debug&&(r.fillStyle="#fff",r.font="12px sans-serif",r.fillText("contra bullets:"+t.contraBullets.length,0,185),r.fillText("enemy bullets:"+t.enemyBullets.length,0,200),r.fillText("entity:"+t.updates.length,0,215),H.forEach(y=>{Gr(r,y,"red",2)}),t.groundCoordinates.forEach(y=>{const P=y.h;Pr(r,y.start+d,P,y.end+d,P,y.type==="land"?"red":"green")}))}}[a];m&&m()},xt=document.getElementById("cursor"),$=document.getElementById("circle"),Me=160;$.style.width=Me+"px";$.style.height=Me+"px";const K=$.getBoundingClientRect();K.left+K.width/2,K.top+K.height/2;const rt=xt.getBoundingClientRect(),G=[rt.left+rt.width/2,rt.top+rt.height/2],Ye=e=>[...e].sort((t,n)=>t.pageX-n.pageX)[0],li=e=>{const t=Ye(e.touches);return{x:t.pageX,y:t.pageY}},hi=O($,"touchstart"),di=O($,"touchmove"),pi=O($,"touchend"),Re=document.getElementById("key_btns"),gi=()=>({A:!1,B:!1,C:!1,keys:!0}),mi=O(Re,"mouseup").pipe(x(e=>({A:!1,B:!1,C:!1,keys:!0})),Ln(200)),yi=O(Re,"touchstart").pipe(x(e=>e.target.getAttribute("data-value")),x(e=>Object.assign(gi(),{[e]:!0})),Tt(mi)),vi=(e,t)=>e.map((n,r)=>Math.abs(n-t[r])),bi=(e,t)=>Math.sqrt(e*e+t*t),ee=K.width/2,Ai=e=>{const{x:t,y:n}=li(e);return Math.atan2(G[1]-n,t-G[0])*180/Math.PI},ne=[{key:"right",match:e=>e>=-22.5&&e<22.5},{key:"topRight",match:e=>e>=22.5&&e<67.5},{key:"top",match:e=>e>=67.5&&e<112.5},{key:"topLeft",match:e=>e>=112.5&&e<157.5},{key:"left",match:e=>e>=157.5||e<-157.5},{key:"bottomLeft",match:e=>e>=-157.5&&e<-112.5},{key:"bottom",match:e=>e>=-112.5&&e<-67.5},{key:"bottomRight",match:e=>e>=-67.5&&e<-22.5}],wi=e=>{if(e.type==="touchend")return"";const t=Ai(e);for(let n=0;n<ne.length;n++){const r=ne[n];if(r.match(t))return r.key}},xi={top:1,bottomRight:2,right:3,topRight:4,bottom:-1,topLeft:-2,left:-3,bottomLeft:-4},Ii=Xn(hi,di,pi).pipe(Dn(e=>{if(e.type==="touchend")return xt.style.transform="translate3d(0, 0, 0)";e.preventDefault();const t=Ye(e.touches),{pageX:n,pageY:r}=t,i=bi(...vi(G,[n,r])),o={};if(i<ee)o.x=n,o.y=r;else{const s=ee/i,[a,u]=G;o.x=a+(n-a)*s,o.y=u+(r-u)*s}xt.style.transform=`translate3d(${o.x-G[0]}px, ${o.y-G[1]}px, 0)`}),x(e=>wi(e)),x(e=>({A:"",B:"",direction:e,directionValue:xi[e]||0,type:e?"keydown":"keyup"})),Tt(yi),Ht((e,t)=>t.keys?Object.assign(e,t):t,{})),Y=document.getElementById("canvas"),Oe=window.innerWidth,je=window.innerHeight,Yt=Y.width,Rt=Y.height;Lr(Y,Oe,je,Yt,Rt);const Q=Y.getContext("2d");Q.font="bold 24px verdana, sans-serif";Q.fillStyle="#fff";Q.fillText("点击开始游戏",Yt/2-60,Rt/2);const Bi=()=>{Q.clearRect(0,0,Oe,je)};window.debug=!1;const Si=Jn.pipe(Tt(Ii)),Ci=()=>{const t=_t(16.666666666666668,en),n=new _().pipe(Ht((o,s)=>{var f;let a={};s.gc&&(a={updates:dt(o.updates),enemyBullets:dt(o.enemyBullets),contraBullets:dt(o.contraBullets)});const u=s.sourceLoading;if(u){const c=(f=u==null?void 0:u.value)==null?void 0:f.name,h=u.value;return c==="background"&&(a.backgroundWidth=h.width,a.backgroundHeight=h.height),o.source[c]=h,o.source.loadedCount=u.loadedCount,o.source.total=u.total,Object.assign(o,a)}return Object.assign(o,s,a)},{}));Mr().subscribe(o=>{n.next({sourceLoading:o})}),_t(50).subscribe(()=>{n.next({gc:!0})}),ui.subscribe(o=>{o&&(console.log("whosyourdaddy"),n.next({cheats:!0,lifes:30}))});const i=t.pipe(Kn(n,Si.pipe(Wn(null)))).subscribe(ci);n.next({scene:"loading",ctx:Q,FPS:60,canvas:Y,cheats:!1,width:Y.width,height:Y.height,backgroundWidth:0,backgroundHeight:0,deltaX:0,clear:Bi,lifes:window.debug?30:2,score:0,gc:!1,mainData$:n,stream$:i,source:{},type:Xt,enemyBullets:[],contraBullets:[],canvasWidth:Yt,canvasHeight:Rt,updates:[],inScreen:Yr(Y.width,Y.height)})},Le=()=>{document.body.removeEventListener("click",Le),Ci()};document.body.addEventListener("click",Le);
